<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta author="Weldercris Ribeiro" />
    <title>Cadastro de Empresas - Infarma HUB</title>
    <link
      rel="shortcut icon"
      type="image/png"
      href="https://www.infarma.com.br/wp-content/themes/infarmasitev2/assets/img/2023/favicon_white.png"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              inter: ["Inter", "sans-serif"],
            },
            colors: {
              primary: "#003973",
              infarmaBlue: "#003973",
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-image: linear-gradient(
          to bottom right,
          #0f345c,
          #0096b1,
          #0f345c
        );
      }
      .modal {
        display: none;
      }
      .modal.open {
        display: flex;
      }

      .table-container {
        /* Define altura fixa para scroll interno se tiver muitos itens */
        max-height: calc(100vh - 280px);
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem; /* rounded-xl */
      }
      .table-container::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .table-container::-webkit-scrollbar-track {
        background: transparent;
      }
      .table-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      .table-container::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Cabeçalho fixo */
      .table-container thead th {
        position: sticky;
        top: 0;
        background-color: #f8fafc; /* gray-50 */
        z-index: 10;
      }
    </style>
  </head>

  <body
    class="min-h-screen flex flex-col items-center justify-start font-inter pt-10 px-4 pb-4"
  >
    <div
      class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-7xl flex flex-col h-full max-h-[95vh]"
    >
      <div
        class="flex flex-col md:flex-row items-center justify-between mb-6 border-b border-gray-100 pb-5 gap-4"
      >
        <div class="flex items-center self-start md:self-auto">
          <img
            src="https://www.infarma.com.br/wp-content/themes/infarmasitev2/assets/img/2023/favicon.png"
            alt="Logo Infarma"
            class="w-10 h-10 mr-3"
          />
          <div>
            <h2 class="text-xl font-bold text-gray-800 tracking-tight">
              Gerenciamento de Clientes
            </h2>
            <p class="text-xs text-gray-500 font-medium">
              Controle de Versões e Serviços
            </p>
          </div>
        </div>

        <div class="flex items-center space-x-3 self-end md:self-auto">
          <a
            href="menu.html"
            class="group flex items-center text-gray-500 hover:text-primary transition-colors font-medium text-sm px-3 py-2 rounded-lg hover:bg-gray-50 border border-transparent hover:border-gray-200"
          >
            <i
              class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"
            ></i>
            Voltar
          </a>
        </div>
      </div>

      <div class="flex justify-between items-center mb-5">
        <div class="flex items-center space-x-3">
          <label for="serviceFilter" class="text-sm font-medium text-gray-600"
            >Filtrar Serviço</label
          >
          <select
            id="serviceFilter"
            class="px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white"
          >
            <option value="all">Todos</option>
            <option value="Apihub">Apihub</option>
            <option value="Convênio">Convênio Web</option>
            <option value="Fiscal">Fiscal</option>
            <option value="Outro">Outro</option>
          </select>
        </div>

        <div>
          <button
            id="newClientBtn"
            class="bg-primary text-white px-5 py-2.5 rounded-lg hover:bg-blue-900 transition-all shadow-md hover:shadow-lg font-semibold text-sm flex items-center transform hover:-translate-y-0.5"
          >
            <i class="fas fa-plus mr-2"></i> NOVO CADASTRO
          </button>
        </div>
      </div>

      <div class="table-container shadow-sm bg-white flex-grow">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-[25%]"
              >
                Nome
              </th>
              <th
                class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-[15%]"
              >
                CNPJ
              </th>
              <th
                class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-[15%]"
              >
                Serviço
              </th>
              <th
                class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-[15%]"
              >
                V. Varejo
              </th>
              <th
                class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-[15%]"
              >
                Obs/Versão
              </th>
              <th
                class="px-4 py-4 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-[7%]"
              >
                Editar
              </th>
              <th
                class="px-4 py-4 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-[8%]"
              >
                Excluir
              </th>
            </tr>
          </thead>
          <tbody
            id="dataBody"
            class="bg-white divide-y divide-gray-100 text-sm text-gray-700"
          ></tbody>
        </table>
      </div>

      <footer
        class="text-xs text-gray-400 mt-4 text-center border-t border-gray-100 pt-3"
      >
        <p id="versionFooter">Carregando versão...</p>
      </footer>
    </div>

    <div
      id="clientModal"
      class="modal fixed inset-0 z-50 bg-gray-900 bg-opacity-60 items-center justify-center backdrop-blur-sm transition-opacity"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 transform transition-all p-0 overflow-hidden"
      >
        <div class="bg-primary px-6 py-4 flex justify-between items-center">
          <h3 class="text-lg font-bold text-white flex items-center">
            <i class="fa-solid fa-building mr-2"></i> Cadastro de Empresa
          </h3>
          <button
            type="button"
            id="closeModalIcon"
            class="text-white hover:text-gray-200 transition-colors"
          >
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>

        <form id="clientForm" class="p-6">
          <div class="space-y-4">
            <div>
              <label
                for="inputName"
                class="block text-sm font-semibold text-gray-700 mb-1"
                >Nome da Empresa</label
              >
              <input
                type="text"
                id="inputName"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none transition-all text-sm"
              />
            </div>
            <div>
              <label
                for="inputCnpj"
                class="block text-sm font-semibold text-gray-700 mb-1"
                >CNPJ</label
              >
              <input
                type="text"
                id="inputCnpj"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none transition-all text-sm"
              />
            </div>
            <div>
              <label
                for="inputService"
                class="block text-sm font-semibold text-gray-700 mb-1"
                >Tipo de Serviço</label
              >
              <div class="relative">
                <select
                  id="inputService"
                  required
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none transition-all bg-white appearance-none text-sm"
                >
                  <option value="">Selecione...</option>
                  <option value="Apihub">Apihub</option>
                  <option value="Convênio">Convênio Web</option>
                  <option value="Fiscal">Fiscal</option>
                  <option value="Outro">Outro</option>
                </select>
                <div
                  class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"
                >
                  <i class="fas fa-chevron-down text-xs mr-2"></i>
                </div>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label
                  for="inputVarejo"
                  class="block text-sm font-semibold text-gray-700 mb-1"
                  >Versão Varejo</label
                >
                <input
                  type="text"
                  id="inputVarejo"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none transition-all text-sm"
                />
              </div>
              <div>
                <label
                  for="inputObservation"
                  class="block text-sm font-semibold text-gray-700 mb-1"
                  >Obs / Versão</label
                >
                <input
                  type="text"
                  id="inputObservation"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary outline-none transition-all text-sm"
                />
              </div>
            </div>
          </div>

          <div
            class="mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-100"
          >
            <button
              type="button"
              id="closeModalBtn"
              class="px-4 py-2 rounded-lg text-gray-600 font-medium hover:bg-gray-100 transition-colors text-sm"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="bg-primary text-white px-5 py-2 rounded-lg hover:bg-blue-800 font-semibold shadow-md transition-all flex items-center text-sm"
            >
              <i class="fas fa-save mr-2"></i> Salvar
            </button>
          </div>
        </form>
      </div>
    </div>

    <script type="module">
      import { verificarPermissao } from "../assets/js/auth.js";
      import { APP_VERSION } from "../assets/js/config.js";

      document.addEventListener("DOMContentLoaded", () => {
        verificarPermissao(["admin"]);

        // Modal close helpers
        const modal = document.getElementById("clientModal");
        const closeIcon = document.getElementById("closeModalIcon");
        const closeBtn = document.getElementById("closeModalBtn");
        const closeModal = () => modal.classList.remove("open");
        if (closeIcon) closeIcon.addEventListener("click", closeModal);
        if (closeBtn) closeBtn.addEventListener("click", closeModal);

        const footerEl = document.getElementById("versionFooter");
        if (footerEl) {
          const ano = new Date().getFullYear();
          footerEl.innerHTML = `© ${ano} Weldercris Ribeiro. Versão ${
            APP_VERSION || "..."
          }`;
        }
      });
    </script>

    <script type="module" src="../assets/js/config.js"></script>
    <script type="module" src="../assets/js/cadastro.js"></script>
    <script type="module" src="../assets/js/avisos.js"></script>
  </body>
</html>
